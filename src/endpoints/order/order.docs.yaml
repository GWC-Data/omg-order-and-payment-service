/orders:
  post:
    summary: Create order
    operationId: createOrder
    tags:
      - Orders
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - userId
              - templeId
              - orderType
            properties:
              userId: { type: string, format: uuid }
              templeId: { type: string, format: uuid }
              addressId: { type: string, format: uuid }
              orderType:
                type: string
                enum: [darshan, puja, prasad, product, event]
              status:
                type: string
                enum: [pending, confirmed, processing, ready, shipped, completed, cancelled, refunded]
              scheduledDate: { type: string, format: date }
              scheduledTimestamp: { type: string, format: date-time }
              fulfillmentType:
                type: string
                enum: [pickup, delivery, in_person, digital]
              subtotal: { type: number }
              discountAmount: { type: number }
              convenienceFee: { type: number }
              taxAmount: { type: number }
              totalAmount: { type: number }
              currency: { type: string }
              paymentStatus:
                type: string
                enum: [pending, paid, failed, refunded]
              paymentMethod: { type: string }
              paymentId: { type: string, description: 'Razorpay order ID (e.g., order_S2PyZlWSMebvca)' }
              paidAt: { type: string, format: date-time }
              trackingNumber: { type: string }
              carrier: { type: string }
              shippedAt: { type: string, format: date-time }
              deliveredAt: { type: string, format: date-time }
              contactName: { type: string }
              contactPhone: { type: string }
              contactEmail: { type: string }
              cancelledAt: { type: string, format: date-time }
              cancellationReason: { type: string }
              refundAmount: { type: number }
              shippingAddress:
                type: string
                description: Full shipping address (address, city, state, country combined)
              deliveryType:
                type: string
                enum: [standard, express]
                description: Delivery speed type
    responses:
      '201':
        description: Order created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Order created successfully
                data:
                  type: object
                  properties:
                    order:
                      $ref: '#/components/schemas/Order'
      '400':
        description: Bad request - invalid order data
        $ref: '#/components/responses/BadRequest'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'

  get:
    summary: Get all orders
    operationId: getAllOrders
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: page
        in: query
        required: false
        schema: { type: integer, minimum: 1, default: 1 }
      - name: limit
        in: query
        required: false
        schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
      - name: userId
        in: query
        required: false
        schema: { type: string, format: uuid }
      - name: templeId
        in: query
        required: false
        schema: { type: string, format: uuid }
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum: [pending, confirmed, processing, ready, shipped, completed, cancelled, refunded]
      - name: orderType
        in: query
        required: false
        schema:
          type: string
          enum: [darshan, puja, prasad, product, event]
      - name: paymentStatus
        in: query
        required: false
        schema:
          type: string
          enum: [pending, paid, failed, refunded]
      - name: startDate
        in: query
        required: false
        schema: { type: string, format: date }
      - name: endDate
        in: query
        required: false
        schema: { type: string, format: date }
    responses:
      '200':
        description: Orders fetched successfully with enriched user profiles, OrderItems, and OrderStatusHistory
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Orders fetched successfully
                data:
                  type: object
                  properties:
                    orders:
                      type: array
                      description: Array of orders with enriched user profiles, OrderItems, and OrderStatusHistory
                      items:
                        type: object
                        allOf:
                          - $ref: '#/components/schemas/Order'
                          - type: object
                            properties:
                              orderItems:
                                type: array
                                items:
                                  $ref: '#/components/schemas/OrderItem'
                                description: Array of order items associated with this order
                              orderStatusHistory:
                                type: array
                                items:
                                  $ref: '#/components/schemas/OrderStatusHistory'
                                description: Array of status history entries for this order
                    pagination:
                      type: object
                      properties:
                        page:
                          type: integer
                          example: 1
                        limit:
                          type: integer
                          example: 20
                        total:
                          type: integer
                          example: 100
                        totalPages:
                          type: integer
                          example: 5
      '400':
        description: Bad request - invalid query parameters
        $ref: '#/components/responses/BadRequest'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'

/orders/{id}:
  get:
    summary: Get order by id
    operationId: getOrderById
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Order fetched successfully with enriched user profile, OrderItems, and OrderStatusHistory
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Order fetched successfully
                data:
                  type: object
                  properties:
                    order:
                      allOf:
                        - $ref: '#/components/schemas/Order'
                        - type: object
                          description: Order with enriched user profile from identity service
                    orderItems:
                      type: array
                      items:
                        $ref: '#/components/schemas/OrderItem'
                      description: Array of order items for this order
                    orderStatusHistory:
                      type: array
                      items:
                        $ref: '#/components/schemas/OrderStatusHistory'
                      description: Array of status history entries for this order
      '404':
        description: Order not found
        $ref: '#/components/responses/NotFound'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'

/orders/user/{userId}:
  get:
    summary: Get orders by user ID
    operationId: getOrdersByUserId
    description: Fetches all orders for a specific user with OrderItems and OrderStatusHistory. Supports pagination and optional filtering.
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: userId
        in: path
        required: true
        schema: { type: string, format: uuid }
        description: The user ID to fetch orders for
      - name: page
        in: query
        required: false
        schema: { type: integer, minimum: 1, default: 1 }
        description: Page number for pagination
      - name: limit
        in: query
        required: false
        schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
        description: Number of orders per page
      - name: orderType
        in: query
        required: false
        schema:
          type: string
          enum: [darshan, puja, prasad, product, event]
        description: Filter orders by type
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum: [pending, confirmed, processing, ready, shipped, completed, cancelled, refunded]
        description: Filter orders by status
      - name: paymentStatus
        in: query
        required: false
        schema:
          type: string
          enum: [pending, paid, failed, refunded]
        description: Filter orders by payment status
      - name: startDate
        in: query
        required: false
        schema: { type: string, format: date }
        description: Filter orders scheduled on or after this date (YYYY-MM-DD)
      - name: endDate
        in: query
        required: false
        schema: { type: string, format: date }
        description: Filter orders scheduled on or before this date (YYYY-MM-DD)
    responses:
      '200':
        description: Orders fetched successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
                data:
                  type: object
                  properties:
                    orders:
                      type: array
                      description: Array of orders with enriched user profiles, OrderItems, and OrderStatusHistory
                      items:
                        type: object
                        allOf:
                          - $ref: '#/components/schemas/Order'
                          - type: object
                            properties:
                              orderItems:
                                type: array
                                items:
                                  $ref: '#/components/schemas/OrderItem'
                                description: Array of order items associated with this order
                              orderStatusHistory:
                                type: array
                                items:
                                  $ref: '#/components/schemas/OrderStatusHistory'
                                description: Array of status history entries for this order
                    pagination:
                      type: object
                      properties:
                        page:
                          type: integer
                        limit:
                          type: integer
                        total:
                          type: integer
                        totalPages:
                          type: integer
      '400':
        description: Bad request - invalid userId or query parameters
      '401':
        description: Unauthorized
      '500':
        description: Server error

/orders/{orderId}/details:
  get:
    summary: Get order details (order + items + status history)
    operationId: getOrderDetails
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: orderId
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Order details fetched successfully with enriched user profile, OrderItems, and OrderStatusHistory
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Order details fetched successfully
                data:
                  type: object
                  properties:
                    order:
                      allOf:
                        - $ref: '#/components/schemas/Order'
                        - type: object
                          description: Order with enriched user profile from identity service
                    orderItems:
                      type: array
                      items:
                        $ref: '#/components/schemas/OrderItem'
                      description: Array of order items for this order
                    orderStatusHistory:
                      type: array
                      items:
                        $ref: '#/components/schemas/OrderStatusHistory'
                      description: Array of status history entries for this order
      '404':
        description: Order not found
        $ref: '#/components/responses/NotFound'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'

  put:
    summary: Update order
    operationId: updateOrder
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              userId: { type: string, format: uuid }
              templeId: { type: string, format: uuid }
              addressId: { type: string, format: uuid }
              orderType:
                type: string
                enum: [darshan, puja, prasad, product, event]
              status:
                type: string
                enum: [pending, confirmed, processing, ready, shipped, completed, cancelled, refunded]
              scheduledDate: { type: string, format: date }
              scheduledTimestamp: { type: string, format: date-time }
              fulfillmentType:
                type: string
                enum: [pickup, delivery, in_person, digital]
              subtotal: { type: number }
              discountAmount: { type: number }
              convenienceFee: { type: number }
              taxAmount: { type: number }
              totalAmount: { type: number }
              currency: { type: string }
              paymentStatus:
                type: string
                enum: [pending, paid, failed, refunded]
              paymentMethod: { type: string }
              paymentId: { type: string, description: 'Razorpay order ID (e.g., order_S2PyZlWSMebvca)' }
              paidAt: { type: string, format: date-time }
              trackingNumber: { type: string }
              carrier: { type: string }
              shippedAt: { type: string, format: date-time }
              deliveredAt: { type: string, format: date-time }
              contactName: { type: string }
              contactPhone: { type: string }
              contactEmail: { type: string }
              cancelledAt: { type: string, format: date-time }
              cancellationReason: { type: string }
              refundAmount: { type: number }
              shippingAddress:
                type: string
                description: Full shipping address (address, city, state, country combined)
              deliveryType:
                type: string
                enum: [standard, express]
                description: Delivery speed type
    responses:
      '200':
        description: Order updated successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Order updated successfully
                data:
                  type: object
                  properties:
                    order:
                      $ref: '#/components/schemas/Order'
                      description: Updated order
      '404':
        description: Order not found
        $ref: '#/components/responses/NotFound'
      '400':
        description: Bad request - invalid order data
        $ref: '#/components/responses/BadRequest'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'

  delete:
    summary: Delete order
    operationId: deleteOrder
    tags:
      - Orders
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: string, format: uuid }
    responses:
      '200':
        description: Order deleted successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: Order deleted successfully
                data:
                  type: object
                  description: Empty data object
      '404':
        description: Order not found
        $ref: '#/components/responses/NotFound'
      '401':
        description: Unauthorized
        $ref: '#/components/responses/NotFound'
      '500':
        description: Server error
        $ref: '#/components/responses/ServerError'


